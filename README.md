# 陪玩店小程序

基于微信小程序云开发的陪玩店管理系统（无支付版本）

## 项目概述

本项目是一个陪玩店小程序，支持老板、员工、管理员三种角色，实现了订单管理、报备审核、用户管理等功能。根据PRD要求，本版本不包含任何支付、充值、钱包相关功能。

## 技术栈

- **框架**: 微信小程序原生框架
- **语言**: TypeScript
- **云开发**: 微信云开发
- **环境ID**: `cloud1-7g62s1bob33a0a2c`

## 项目结构

```
miniprogram-9/
├── miniprogram/              # 小程序前端代码
│   ├── pages/               # 页面目录
│   │   ├── boss/           # 老板端页面
│   │   ├── staff/          # 员工端页面
│   │   ├── admin/          # 管理员端页面
│   │   └── auth/           # 认证页面
│   ├── custom-tab-bar/     # 自定义TabBar
│   ├── utils/              # 工具函数
│   └── app.ts              # 小程序入口
├── cloudfunctions/          # 云函数目录
│   ├── getUserInfo/        # 获取用户信息
│   ├── createOrder/        # 创建订单
│   ├── submitReport/       # 提交报备
│   ├── auditReport/        # 审核报备
│   ├── updateUserRole/     # 更新用户角色
│   └── bindBossStaff/       # 绑定老板和员工
├── docs/                    # 文档目录
│   ├── prd.md              # 产品需求文档
│   └── database.md          # 数据库结构说明
└── prototype/               # 原型页面（HTML）
```

## 角色权限

### 老板（Boss）
- 查看员工信息
- 接收并确认/拒绝订单
- 查看订单记录
- 申请更换直属员工
- 提交客诉反馈

### 员工（Staff）
- 创建订单（仅能为绑定的老板创建）
- 提交报备
- 查看排行榜
- 维护个人资料
- 查看订单和报备记录

### 管理员（Admin）
- 用户管理（修改角色、绑定关系）
- 内容管理（轮播图、公告、推荐等）
- 审核功能（报备审核、更换申请审核）
- 数据查看（订单、报备、统计）

### 超级管理员（SuperAdmin）
- 拥有管理员全部权限
- 可以设置其他用户为管理员

## 快速开始

### 1. 环境准备

- 安装微信开发者工具
- 注册微信小程序账号
- 开通云开发服务

### 2. 配置云开发

1. 在微信开发者工具中打开项目
2. 在 `app.ts` 中已配置环境ID：`cloud1-7g62s1bob33a0a2c`
3. 确保云开发环境已创建并激活

### 3. 创建数据库集合

参考 `docs/database.md` 文档创建以下集合：
- `users` - 用户表
- `orders` - 订单表
- `reports` - 报备表
- `bindings` - 绑定关系表
- `roleChangeRequests` - 更换直属申请表
- `content` - 内容管理表
- `rankings` - 排行榜表

### 4. 部署云函数

1. 在微信开发者工具中，右键点击 `cloudfunctions` 目录下的每个云函数文件夹
2. 选择「上传并部署：云端安装依赖」
3. 等待部署完成

需要部署的云函数：
- `getUserInfo`
- `createOrder`
- `submitReport`
- `auditReport`
- `updateUserRole`
- `bindBossStaff`

### 5. 数据库初始化

运行项目前，请先执行数据库初始化：

1. 在微信开发者工具的云开发控制台中，依次创建以下集合：
   - `users` - 用户表
   - `orders` - 订单表
   - `reports` - 报备表
   - `bindings` - 绑定关系表
   - `roleChangeRequests` - 更换直属申请表
   - `content` - 内容管理表
   - `rankings` - 排行榜表

2. 或者使用项目根目录下的 `database-init.js` 脚本进行初始化（需要先获取你的openid）

### 6. 初始化管理员

在云开发控制台的数据库中，手动创建第一个超级管理员用户（参考 `docs/database.md`）

### 7. 运行项目

1. 在微信开发者工具中点击「编译」
2. 使用管理员账号登录
3. 开始使用

## 核心功能

### 订单管理
- 员工创建订单（无金额）
- 老板确认/拒绝订单
- 订单状态流转：待确认 → 已确认 → 已完成

### 报备管理
- 员工提交报备
- 管理员审核报备
- 支持上传订单截图

### 用户管理
- 管理员修改用户角色
- 管理员绑定老板和员工关系
- 查看用户统计信息

### 内容管理
- 主页轮播图管理
- 公告和生日祝福
- 推荐页员工推荐配置
- 相册集合管理

## 重要说明

### 无支付版本
根据PRD要求，本版本**不包含**以下功能：
- ❌ 充值
- ❌ 支付
- ❌ 钱包
- ❌ 金额计算
- ❌ 退款
- ❌ 财务流水

所有涉及金额的UI和功能已移除。

### 角色默认设置
- 新用户首次进入小程序，默认角色为「老板（Boss）」
- 只有管理员可以修改用户角色
- 只有管理员可以创建绑定关系

### 订单规则
- 订单只能由员工创建
- 订单只能发给绑定的老板
- 订单无金额，仅用于服务记录和确认

## 开发指南

### 添加新页面
1. 在 `miniprogram/pages` 下创建页面目录
2. 在 `app.json` 的 `pages` 数组中添加页面路径
3. 创建对应的 `.wxml`、`.ts`、`.wxss` 文件

### 添加新云函数
1. 在 `cloudfunctions` 目录下创建云函数文件夹
2. 创建 `index.js` 和 `package.json`
3. 在微信开发者工具中部署云函数

### 数据库操作
参考 `docs/database.md` 了解数据库结构，使用云开发SDK进行数据库操作。

## 常见问题

### Q: 如何设置第一个管理员？
A: 参考 `docs/database.md` 中的「初始化数据」部分，在数据库中手动创建超级管理员用户。

### Q: 如何修改用户角色？
A: 使用管理员账号登录，进入「用户管理」页面，选择用户后点击「编辑」修改角色。

### Q: 如何绑定老板和员工？
A: 使用管理员账号登录，进入「用户管理」页面，选择员工后点击「绑定老板」进行操作。

### Q: 云函数调用失败？
A: 检查云函数是否已部署，环境ID是否正确，以及数据库权限设置。

## 文档

- [产品需求文档](./docs/prd.md)
- [数据库结构说明](./docs/database.md)

## 许可证

本项目仅供学习和参考使用。
