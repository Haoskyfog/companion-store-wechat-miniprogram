<!-- è€æ¿ç«¯ - æˆ‘çš„ -->

<!-- å…¨å±€é›ªèŠ±å±‚ï¼ˆç‹¬ç«‹äºpageï¼Œfixedå®šä½ï¼‰ -->
<view class="global-snow-layer" wx:if="{{showSnow}}">
  <view wx:for="{{snowflakes}}" wx:key="id"
        class="snowflake"
        style="left: {{item.left}}px; animation-duration: {{item.duration}}s; animation-delay: {{item.delay}}s;">
  </view>
</view>

<view class="page">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decorations">
    <!-- æ—‹è½¬é›ªèŠ± -->
    <text class="rotating-snow snow-1">â„ï¸</text>
    <text class="rotating-snow snow-2">â„ï¸</text>
    <text class="rotating-snow snow-3">â„ï¸</text>
    <text class="rotating-snow snow-4">â„ï¸</text>
    <!-- é™æ€åœ£è¯æ ‘ -->
    <text class="christmas-tree tree-1">ğŸ„</text>
    <text class="christmas-tree tree-2">ğŸ„</text>
    <text class="christmas-tree tree-3">ğŸ„</text>
  </view>

  <!-- åˆ·æ–°æŒ‰é’® -->
  <view class="refresh-btn" bindtap="onRefresh">â†»</view>

  <!-- æ–°è®¢å•æé†’ -->
  <view class="order-notification" wx:if="{{pendingOrderCount > 0}}" bindtap="onOrderNotificationTap">
    <view class="notification-content">
      <text class="notification-text">æ‚¨æœ‰ {{pendingOrderCount}} ä¸ªæ–°è®¢å•å¾…å¤„ç†</text>
    </view>
    <text class="notification-arrow">â€º</text>
  </view>

  <scroll-view scroll-y="{{true}}" class="scroll-content">
    <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
    <view class="user-header-section">
      <view class="user-avatar-container" wx:if="{{!loading}}">
        <view class="user-avatar">
          <image wx:if="{{userInfo.avatar}}" src="{{userInfo.avatar}}" mode="aspectFill" class="avatar-image" />
          <text wx:else class="avatar-text">è€æ¿</text>
        </view>
      </view>
      <view class="user-info-container" wx:if="{{!loading}}">
        <view class="user-name-row">
          <text class="user-name">{{userInfo.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</text>
          <view class="vip-badge" wx:if="{{userInfo.vipLevel}}">{{userInfo.vipLevel}}</view>
        </view>
        <text class="user-id">ID: {{userInfo.userId || 'æœªè®¾ç½®'}}</text>
      </view>
    </view>
    <!-- é’±åŒ…ä¿¡æ¯ -->
    <view class="wallet-info-card" wx:if="{{!loading}}">
      <view class="wallet-info">
        <view class="wallet-content">
          <view class="wallet-details">
            <view class="wallet-title">é’±åŒ…ä½™é¢</view>
            <view class="wallet-balance">Â¥{{walletInfo.balance}}</view>
          </view>
        </view>
        <view class="wallet-divider"></view>
        <view class="wallet-content">
          <view class="wallet-details">
            <view class="wallet-title">æ¶ˆè´¹æ€»é¢</view>
            <view class="wallet-balance">Â¥{{totalConsumption}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- VIP ä¿¡æ¯ -->
    <view class="vip-info-card" wx:if="{{!loading}}" bindtap="onVipTap">
      <view class="vip-info">
        <view class="vip-content">
          <view class="vip-details">
            <view class="vip-title">å°Šè´µVIPä¼šå‘˜</view>
            <view class="vip-desc">äº«å—ä¸“å±ç‰¹æƒ</view>
          </view>
        </view>
        <text class="arrow">â€º</text>
      </view>
    </view>

    <!-- æˆ‘çš„ç›´å±å‘˜å·¥ & æˆ‘çš„æƒç›Š -->
    <view class="two-column-section">
      <!-- æˆ‘çš„ç›´å±å‘˜å·¥ -->
      <view class="staff-section surface staff-card-small">
        <view class="section-header">
          <text class="section-title">æˆ‘çš„ç›´å±</text>
        </view>
        <scroll-view scroll-x="{{true}}" class="staff-scroll">
          <view class="staff-item" wx:for="{{myStaffs}}" wx:key="_openid">
            <view class="staff-avatar-small">
              <image wx:if="{{item.avatar}}" src="{{item.avatar}}" mode="aspectFill" class="avatar-image-small" />
              <text wx:else class="staff-text-small">å‘˜</text>
            </view>
            <text class="staff-name-small">{{item.nickname}}</text>
          </view>
        </scroll-view>
      </view>

      <!-- æˆ‘çš„æƒç›Š -->
      <view class="benefits-section surface benefits-card-large" bindtap="showBenefits">
        <view class="section-header">
          <text class="section-title">æˆ‘çš„æƒç›Š</text>
        </view>
        <view class="benefits-preview">
          <view class="benefits-text-preview" wx:if="{{benefitsContent}}">
            <text>{{benefitsContent}}</text>
          </view>
          <view class="benefits-empty-preview" wx:else>
            <text class="benefits-hint">æš‚æ— æƒç›Š</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æƒç›Šå¼¹çª— -->
    <view class="benefits-popup-mask" wx:if="{{showBenefitsPopup}}" bindtap="closeBenefits">
      <view class="benefits-popup" catchtap="">
        <view class="popup-header">
          <text class="popup-title">æˆ‘çš„æƒç›Š</text>
          <view class="popup-close" bindtap="closeBenefits">Ã—</view>
        </view>
        <view class="popup-content">
          <view class="benefits-content" wx:if="{{benefitsContent}}">
            <text>{{benefitsContent}}</text>
          </view>
          <view class="benefits-empty" wx:else>
            <text class="empty-text">æš‚æ— æƒç›Šå†…å®¹</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¸»çº¿æ•…äº‹ -->
    <view class="story-section surface" wx:if="{{!loading}}">
      <view class="section-header">
        <text class="section-title">ä¸»çº¿æ•…äº‹</text>
      </view>
      <view class="story-content">
        <view class="story-text">{{storyContent}}</view>
        <view class="story-level">å½“å‰ç­‰çº§ï¼š{{currentLevelName}}</view>
      </view>
    </view>

    <!-- èœå•åˆ—è¡¨ -->
    <view class="menu-section surface">
      <view class="menu-item" wx:for="{{menuList}}" wx:key="id" data-action="{{item.action}}" bindtap="onMenuTap">
        <view class="menu-icon" style="background: {{item.bgColor}};">
          <text class="icon-emoji">{{item.icon}}</text>
        </view>
        <view class="menu-info">
          <view class="menu-title">{{item.title}}</view>
          <view class="menu-desc">{{item.desc}}</view>
        </view>
        <text class="arrow">â€º</text>
      </view>
    </view>

    <!-- å¼€å‘è€…ä¿¡æ¯ -->
    <view class="developer-card" wx:if="{{developerInfo}}">
      <view class="dev-avatar">
        <image wx:if="{{developerInfo.avatar}}" src="{{developerInfo.avatar}}" mode="aspectFill" class="dev-avatar-img" />
      </view>
      <view class="dev-info">
        <view class="dev-title">å¼€å‘è€…ï¼š{{developerInfo.nickname || developerInfo.userId}}</view>
        <view class="dev-contact">å¾®ä¿¡å·ï¼šfoggy_dream77</view>
        <view class="dev-contact">é‚®ç®±ï¼šlostinskyfog.dev@gmail.com</view>
      </view>
      <view class="dev-tip-btn" bindtap="showTipQrcode">æ‰“èµ</view>
    </view>
    <view class="dev-thanks">åˆ¶ä½œä¸æ˜“ï¼Œæ„Ÿè°¢æ”¯æŒ â™¥</view>

    <!-- æ‰“èµå¼¹çª— -->
    <view class="tip-popup-mask" wx:if="{{showTipPopup}}" bindtap="closeTipPopup">
      <view class="tip-popup" catchtap="">
        <view class="tip-header">æ„Ÿè°¢æ”¯æŒ</view>
        <image class="tip-qrcode" src="{{tipQrcodeUrl}}" mode="aspectFit" />
        <view class="tip-hint">é•¿æŒ‰è¯†åˆ«äºŒç»´ç æ‰“èµ</view>
        <view class="tip-close" bindtap="closeTipPopup">å…³é—­</view>
      </view>
    </view>

    <view class="bottom-spacer"></view>
  </scroll-view>
</view>
