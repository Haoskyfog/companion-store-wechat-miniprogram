<!-- ç®¡ç†å‘˜ç«¯ - å®¡æ ¸ä¸­å¿ƒ -->
<view class="page">
  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab-btn {{activeTab === 'reports' ? 'active' : ''}}" bindtap="onTabChange" data-tab="reports">
      æŠ¥å¤‡å®¡æ ¸ ({{reports.length}})
    </view>
    <view class="tab-btn {{activeTab === 'requests' ? 'active' : ''}}" bindtap="onTabChange" data-tab="requests">
      æ›´æ¢ç”³è¯· ({{requests.length}})
    </view>
  </view>

  <!-- æŠ¥å¤‡å®¡æ ¸åˆ—è¡¨ -->
  <view class="audit-list" wx:if="{{activeTab === 'reports'}}">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:elif="{{reports.length === 0}}">
      <view class="empty-icon">âœ…</view>
      <view class="empty-text">æš‚æ— å¾…å®¡æ ¸æŠ¥å¤‡</view>
    </view>

    <!-- æŠ¥å¤‡é¡¹ -->
    <block wx:elif="{{reports.length > 0}}">
      <view class="audit-item" wx:for="{{reports}}" wx:for-item="report" wx:key="_id">
      <view class="audit-header">
        <view class="staff-info">
          <view class="staff-avatar">
            <image wx:if="{{report.staffInfo.avatar}}" src="{{report.staffInfo.avatar}}" mode="aspectFill" class="avatar-image" />
            <text wx:else>ğŸ®</text>
          </view>
          <view class="staff-details">
            <text class="staff-name">{{report.staffInfo.nickname}}</text>
            <text class="staff-id">ID: {{report.staffInfo.userId}}</text>
          </view>
        </view>
        <view class="boss-info">
          <text class="boss-label">å…³è”è€æ¿:</text>
          <text class="boss-name">{{report.bossInfo.nickname}} (ID: {{report.bossInfo.userId}})</text>
        </view>
      </view>

      <view class="audit-content">
        <view class="audit-info">
          <view class="info-row">
            <text class="info-label">æ¥å•æ—¥æœŸ:</text>
            <text class="info-value">{{report.date}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æ¸¸æˆç±»å‹:</text>
            <text class="info-value">{{report.game}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æœåŠ¡æ—¶é•¿:</text>
            <text class="info-value">{{report.duration}}å°æ—¶</text>
          </view>
          <view class="info-row">
            <text class="info-label">è®¢å•é‡‘é¢:</text>
            <text class="info-value">Â¥{{report.amount || 0}}</text>
          </view>
          <view class="info-row" wx:if="{{report.platform}}">
            <text class="info-label">æ¥å•å¹³å°:</text>
            <text class="info-value">{{report.platform}}</text>
          </view>
          <view class="info-row" wx:if="{{report.services && report.services.length > 0}}">
            <text class="info-label">æœåŠ¡å†…å®¹:</text>
            <text class="info-value">{{report.services.join('ã€')}}</text>
          </view>
          <view class="info-row" wx:if="{{report.remark}}">
            <text class="info-label">å¤‡æ³¨:</text>
            <text class="info-value">{{report.remark}}</text>
          </view>
        </view>

        <!-- æˆªå›¾é¢„è§ˆ -->
        <view class="image-preview" wx:if="{{report.images && report.images.length > 0}}">
          <text class="preview-label">è®¢å•æˆªå›¾:</text>
          <view class="image-list">
            <image class="preview-image" 
                   wx:for="{{report.images}}" 
                   wx:key="*this"
                   src="{{item}}"
                   mode="aspectFill"
                   show-menu-by-longpress="{{true}}"
                   bindload="onImageLoad"
                   binderror="onImageError"
                   bindtap="onPreviewImage" 
                   data-report-images="{{report.images}}" 
                   data-index="{{index}}" />
          </view>
        </view>
      </view>

      <view class="audit-time">
        <text>{{report.createTime}} æäº¤</text>
      </view>

      <!-- å®¡æ ¸æ“ä½œ -->
      <view class="audit-actions">
        <button class="action-btn reject-btn"
                data-report-id="{{report._id}}"
                data-action="reject"
                bindtap="onAuditReport">
          é©³å›
        </button>
        <button class="action-btn approve-btn"
                data-report-id="{{report._id}}"
                data-action="approve"
                bindtap="onAuditReport">
          é€šè¿‡
        </button>
      </view>
    </view>
    </block>
  </view>

  <!-- æ›´æ¢ç”³è¯·åˆ—è¡¨ -->
  <view class="audit-list" wx:if="{{activeTab === 'requests'}}">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:elif="{{requests.length === 0}}">
      <view class="empty-icon">ğŸ”„</view>
      <view class="empty-text">æš‚æ— å¾…å®¡æ ¸ç”³è¯·</view>
    </view>

    <!-- ç”³è¯·é¡¹ -->
    <block wx:elif="{{requests.length > 0}}">
      <view class="audit-item" wx:for="{{requests}}" wx:key="_id">
      <view class="audit-header">
        <view class="boss-info">
          <view class="boss-avatar">ğŸ‘‘</view>
          <view class="boss-details">
            <text class="boss-name">{{item.bossInfo.nickname}}</text>
            <text class="boss-id">ID: {{item.bossInfo.userId}}</text>
          </view>
        </view>
      </view>

      <view class="audit-content">
        <view class="audit-info">
          <view class="info-row">
            <text class="info-label">ç”³è¯·ç±»å‹:</text>
            <text class="info-value">æ›´æ¢ç›´å±å‘˜å·¥</text>
          </view>
          <view class="info-row">
            <text class="info-label">å½“å‰å‘˜å·¥:</text>
            <text class="info-value">{{item.currentStaffInfo.nickname}} (ID: {{item.currentStaffInfo.userId}})</text>
          </view>
          <view class="info-row">
            <text class="info-label">ç›®æ ‡å‘˜å·¥:</text>
            <text class="info-value">{{item.targetStaffInfo.nickname}} (ID: {{item.targetStaffInfo.userId}})</text>
          </view>
          <view class="info-row" wx:if="{{item.reason}}">
            <text class="info-label">ç”³è¯·åŸå› :</text>
            <text class="info-value">{{item.reason}}</text>
          </view>
        </view>
      </view>

      <view class="audit-time">
        <text>{{item.createTime}} æäº¤</text>
      </view>

      <!-- å®¡æ ¸æ“ä½œ -->
      <view class="audit-actions">
        <button class="action-btn reject-btn"
                data-request-id="{{item._id}}"
                data-action="reject"
                bindtap="onAuditRequest">
          é©³å›
        </button>
        <button class="action-btn approve-btn"
                data-request-id="{{item._id}}"
                data-action="approve"
                bindtap="onAuditRequest">
          é€šè¿‡
        </button>
      </view>
    </view>
    </block>
  </view>
</view>
