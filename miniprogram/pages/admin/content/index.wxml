<!-- ç®¡ç†å‘˜ç«¯ - å†…å®¹ç®¡ç† -->
<view class="page">
  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab-btn {{activeTab === item.key ? 'active' : ''}}" wx:for="{{tabs}}" wx:key="key" data-tab="{{item.key}}" bindtap="onTabChange">
      {{item.label}}
    </view>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-btn" bindtap="showAddModal">
    <text class="add-icon">+</text>
    <text class="add-text">æ·»åŠ {{activeTab === 'banner' ? 'è½®æ’­å›¾' : (activeTab === 'notice' ? 'å…¬å‘Š' : (activeTab === 'gallery' ? 'ç›¸å†Œ' : 'æ¨è'))}}</text>
  </view>

  <!-- å†…å®¹åˆ—è¡¨ -->
  <view class="content-list" wx:if="{{!loading}}">
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{contentList.length === 0}}">
      <view class="empty-icon">ğŸ“„</view>
      <view class="empty-text">æš‚æ— {{activeTab === 'banner' ? 'è½®æ’­å›¾' : (activeTab === 'notice' ? 'å…¬å‘Š' : (activeTab === 'gallery' ? 'ç›¸å†Œ' : 'æ¨è'))}}å†…å®¹</view>
      <view class="empty-desc">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ å†…å®¹</view>
    </view>

    <!-- å†…å®¹é¡¹ -->
    <view class="content-item" wx:for="{{contentList}}" wx:key="_id">
      <view class="content-header">
        <view class="content-info">
          <text class="content-title">{{item.title}}</text>
          <text class="content-meta">{{item.createTime}} Â· æ’åº:{{item.order}}</text>
        </view>
        <view class="content-status {{item.status === 'active' ? 'status-active' : 'status-inactive'}}">
          {{item.status === 'active' ? 'å¯ç”¨' : 'ç¦ç”¨'}}
        </view>
      </view>

      <!-- å†…å®¹é¢„è§ˆ -->
      <view class="content-preview" wx:if="{{item.content}}">
        <text class="content-text">{{item.content}}</text>
      </view>

      <!-- å‘˜å·¥é¢„è§ˆï¼ˆæ¨èå†…å®¹ï¼‰ -->
      <view class="staff-preview" wx:if="{{item.type === 'recommend' && item.staffList && item.staffList.length > 0}}">
        <text class="staff-label">æ¨èå‘˜å·¥:</text>
        <view class="staff-avatars">
          <view class="staff-avatar" wx:for="{{item.staffList}}" wx:key="_openid">
            <image wx:if="{{item.avatar}}" src="{{item.avatar}}" mode="aspectFill" />
            <text wx:else>ğŸ‘¤</text>
          </view>
        </view>
      </view>

      <!-- å›¾ç‰‡é¢„è§ˆï¼ˆå…¬å‘Šç±»å‹ä¸æ˜¾ç¤ºï¼‰ -->
      <view class="image-preview" wx:if="{{item.type !== 'notice' && item.images && item.images.length > 0}}">
        <image class="preview-image" wx:for="{{item.images}}" wx:for-item="image" wx:key="*this" src="{{image}}" mode="aspectFill" />
        <text class="image-count" wx:if="{{item.images.length > 3}}">+{{item.images.length - 3}}</text>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="content-actions">
        <button class="action-btn edit-btn" data-content="{{item}}" bindtap="editContent">
          ç¼–è¾‘
        </button>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† -->
  <view class="modal-overlay {{showAddModal ? 'visible' : ''}}" bindtap="hideModal">
    <view class="modal-content" catchtap="preventTap">
      <view class="modal-header">
        <text class="modal-title">{{editingContent ? 'ç¼–è¾‘' : 'æ·»åŠ '}}{{activeTab === 'banner' ? 'è½®æ’­å›¾' : (activeTab === 'notice' ? 'å…¬å‘Š' : (activeTab === 'gallery' ? 'ç›¸å†Œ' : 'æ¨è'))}}</text>
        <view class="close-btn" bindtap="hideModal">âœ•</view>
      </view>

      <scroll-view scroll-y="{{true}}" class="modal-body">
        <!-- æ¨èç±»å‹ï¼šåªæ˜¾ç¤ºå‘˜å·¥é€‰æ‹© -->
        <view wx:if="{{activeTab === 'recommend'}}">
          <!-- å‘˜å·¥é€‰æ‹©ï¼ˆä»…æ¨èåŠŸèƒ½ï¼‰ -->
          <view class="form-group">
            <text class="form-label">é€‰æ‹©æ¨èå‘˜å·¥ * (æœ€å¤š3ä¸ª)</text>
            <view class="staff-selection">
              <view class="selected-count">å·²é€‰æ‹© {{selectedStaffCount}}/3 ä¸ªå‘˜å·¥</view>
              <view class="staff-list">
                <view class="staff-item {{isStaffSelected(item._openid) ? 'selected' : ''}}"
                      wx:for="{{staffList}}"
                      wx:key="_openid"
                      data-staff-id="{{item._openid}}"
                      bindtap="toggleStaffSelection">
                  <view class="staff-avatar">
                    <image wx:if="{{item.avatar}}" src="{{item.avatar}}" mode="aspectFill" />
                    <text wx:else>ğŸ‘¤</text>
                  </view>
                  <view class="staff-info">
                    <text class="staff-name">{{item.nickname}}</text>
                    <text class="staff-id">ID: {{item.userId}}</text>
                  </view>
                  <view class="select-indicator" wx:if="{{isStaffSelected(item._openid)}}">
                    <text>âœ“</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- å…¶ä»–ç±»å‹ï¼šæ˜¾ç¤ºå®Œæ•´è¡¨å• -->
        <view wx:else>
        <!-- æ ‡é¢˜ -->
        <view class="form-group">
          <text class="form-label">æ ‡é¢˜ *</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ ‡é¢˜" value="{{formData.title}}" data-field="title" bindinput="onInputChange" maxlength="50" />
        </view>

          <!-- å†…å®¹ï¼ˆå…¬å‘Šéœ€è¦ï¼‰ -->
          <view class="form-group" wx:if="{{activeTab === 'notice'}}">
          <text class="form-label">å†…å®¹</text>
          <textarea class="form-textarea" placeholder="è¯·è¾“å…¥å†…å®¹" value="{{formData.content}}" data-field="content" bindinput="onInputChange" maxlength="500" />
        </view>

        <!-- æ’åº -->
        <view class="form-group">
          <text class="form-label">æ’åº</text>
          <input class="form-input" type="number" placeholder="æ•°å­—è¶Šå°è¶Šé å‰" value="{{formData.order}}" data-field="order" bindinput="onInputChange" />
        </view>

        <!-- çŠ¶æ€ -->
        <view class="form-group">
          <text class="form-label">çŠ¶æ€</text>
          <radio-group data-field="status" bindchange="onStatusChange">
            <label class="radio-item" wx:for="{{[{value:'active', label:'å¯ç”¨'}, {value:'inactive', label:'ç¦ç”¨'}]}}" wx:key="value">
              <radio value="{{item.value}}" checked="{{item.value === formData.status}}" />
              <text class="radio-text">{{item.label}}</text>
            </label>
          </radio-group>
        </view>

        <!-- å›¾ç‰‡ä¸Šä¼ ï¼ˆå…¬å‘Šç±»å‹ä¸æ˜¾ç¤ºï¼‰ -->
        <view class="form-group" wx:if="{{activeTab !== 'notice'}}">
          <text class="form-label">å›¾ç‰‡ {{activeTab === 'gallery' ? '(æœ€å¤š9å¼ )' : '(é€‰å¡«)'}}</text>
          <view class="image-upload">
            <view class="image-list">
              <view class="image-item" wx:for="{{formData.images}}" wx:key="*this">
                <image class="uploaded-image" src="{{item}}" mode="aspectFill" />
                <view class="delete-btn" data-index="{{index}}" bindtap="deleteImage">Ã—</view>
              </view>
              <view class="upload-btn" wx:if="{{formData.images.length < 9}}" bindtap="uploadImages">
                <text class="upload-icon">+</text>
                <text class="upload-text">ä¸Šä¼ </text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>

      <view class="modal-footer">
        <button class="cancel-btn" bindtap="hideModal">å–æ¶ˆ</button>
        <button class="delete-modal-btn" wx:if="{{editingContent}}" bindtap="deleteContentFromModal">åˆ é™¤</button>
        <button class="confirm-btn" bindtap="saveContent">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>